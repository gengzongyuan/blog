title: 手机自动化04 控件定位与常用操作
date: 2018-10-08T10:16:01.035Z
tags: [appium,手机自动化]
categories: [测试]
---
#### 控件定位
##### Appium Inspector
- 启动server后打开Appium Inspector

<!--more-->

![](https://upload-images.jianshu.io/upload_images/2572206-d8f49def4871d809.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
- 配置初始化信息，记得Save As的时候做好备注，方便我们以后进行使用
![](https://upload-images.jianshu.io/upload_images/2572206-c03e61d058f6d815.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
- 页面功能
![](https://upload-images.jianshu.io/upload_images/2572206-9ed124bbb2329e83.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
- 通过控件定位定位一下密码的输入框
![](https://upload-images.jianshu.io/upload_images/2572206-27910851791921a8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- 针对这五种组合的属性，appium提供了六种方法供我们进行定位
```
- id属性
driver.find_element_by_id("com.tencent.mobileqq:id/password")
driver.find_element_by_android_uiautomator('new UiSelector().resourceId("com.tencent.mobileqq:id/password")')
```
```
- xpath属性
driver.find_element_by_xpath("\t//android.widget.EditText[@content-desc=\"密码 安全\"]")
```
```
- class+index属性
driver.find_elements_by_class_name("android.widget.EditText")[1]
# uiautomator-全量匹配
driver.find_elements_by_android_uiautomator('new UiSelector().className("android.widget.TextView")')
# uiautomator-正则匹配
driver.find_elements_by_android_uiautomator('new UiSelector().classNameMatches("^android.widget.*")')
```
```
- content-desc定位方式
driver.find_elements_by_accessibility_id("登录")
driver.find_element_by_android_uiautomator('new UiSelector().description("登录")')
driver.find_element_by_android_uiautomator('new UiSelector().descriptionStartsWith("登")')
driver.find_element_by_android_uiautomator('new UiSelector().descriptionMatches(".*录")')
```
```
- text属性
# 全量匹配
driver.find_element_by_android_uiautomator('new UiSelector().text("登 录")')
# 包含text文字
driver.find_element_by_android_uiautomator('new UiSelector().textContains("机")')
# 以text什么开始
driver.find_element_by_android_uiautomator('new UiSelector().textStartsWith("手")')
# 正则匹配
driver.find_element_by_android_uiautomator('new UiSelector().textMatches("^手.*")')
```
```
- 坐标定位方式,直接对坐标进行点击操作
TouchAction(driver).tap([(422, 595)])
```
##### uiautomatorviewer
- 文件路径`android-sdk\android-sdk-windows\tools\uiautomatorviewer.bat`
- uiautomatorviewer的使用很简单,打开app->点击uiautomatorviewer的第二个按钮->鼠标悬停到对应控件上->获取用户属性
![](https://upload-images.jianshu.io/upload_images/2572206-e41e9832ee6a6177.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

#### 常用操作
##### 点击和输入
- 控件点击`click()`
```
ele = driver.find_element_by_android_uiautomator('new UiSelector().text("登 录")')
ele.click()
```
- 坐标点击
```
from appium.webdriver.common.touch_action import TouchAction
--------
看一下源码，传进来四个值
element： 可以传进来一个控件，如果传入了对应的控件，X,Y值的原点就是元素的左上角
X,Y,count
--------
    def tap(self, element=None, x=None, y=None, count=1):
        opts = self._get_opts(element, x, y)
        opts['count'] = count
        self._add_action('tap', opts)

self.driver.tap([(422, 595)])
```
- 输入
```
loginInput = driver.find_element_by_id("com.tencent.mobileqq:id/password")
driver.set_value(loginInput,"password")
loginInput.send_keys("password")  # 这种方式对appium的版本有要求
```
##### 拖拽
- 控件拖拽
```
    def drag_and_drop(self, origin_el, destination_el):
        """Drag the origin element to the destination element

        :Args:
         - originEl - the element to drag
         - destinationEl - the element to drag to
        """
        action = TouchAction(self)
        action.long_press(origin_el).move_to(destination_el).release().perform()
        return self
```

##### 长按
```

endEle = self.driver.find_elements_by_id('com.tencent.mobileqq:id/icon')[-1]
elx = endEle.location.get('x')
ely = endEle.location.get('y')
self.driver.tap([(elx, ely)], duration=2000)
```
